version: '3.8'

services:
  mirror_agent:
    build:
      context: ../mirror
      dockerfile: ../docker/Dockerfile
    container_name: bleulion-mirror-agent
    restart: unless-stopped
    
    environment:
      # Ethereum Provider (Alchemy, Infura, or custom RPC)
      - ETH_PROVIDER=${ETH_PROVIDER:-https://eth-mainnet.g.alchemy.com/v2/YOUR_KEY}
      
      # CODEX API endpoint for mirroring records
      - CODEX_ENDPOINT=${CODEX_ENDPOINT:-https://codex.evolvverse.io/api/v1/records}
      
      # Private key for signing ceremonial records (REQUIRED - set in .env file)
      - MIRROR_SIGNER_PRIVATE_KEY=${MIRROR_SIGNER_PRIVATE_KEY}
      
      # Primary vault address to monitor
      - PRIMARY_VAULT=${PRIMARY_VAULT:-0x36CA5f34E5E873e7c3dF37432081d20b4Af320Be}
      
      # Polling interval in milliseconds (default: 15 seconds)
      - POLL_INTERVAL=${POLL_INTERVAL:-15000}
      
      # Node environment
      - NODE_ENV=production
    
    # Optional: Mount .env file if you prefer file-based configuration
    # volumes:
    #   - ./.env:/app/.env:ro
    
    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    
    # Resource limits (adjust based on your needs)
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M

# Optional: Add a network if you have other services
# networks:
#   bleulion-network:
#     driver: bridge

# Note: For production, consider:
# 1. Using Docker secrets for MIRROR_SIGNER_PRIVATE_KEY instead of environment variables
# 2. Setting up monitoring and alerting
# 3. Implementing log aggregation (e.g., ELK stack, Loki)
# 4. Using a dedicated .env file with proper permissions (chmod 600)
